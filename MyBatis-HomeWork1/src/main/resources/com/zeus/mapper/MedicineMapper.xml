<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zeus.mapper.MedicineMapper">

    <!-- ResultMap 정의 -->
    <resultMap id="MedicineResultMap" type="com.zeus.model.Medicine">
        <id property="medId" column="medId"/>
        <result property="medName" column="medName"/>
        <result property="manufacturer" column="manufacturer"/>
        <result property="stockQty" column="stockQty"/>
        <result property="regDate" column="regDate"/>
    </resultMap>

    <!-- 등록 -->
    <insert id="createMedicine" parameterType="com.zeus.model.Medicine">
        INSERT INTO Medicine (
            medId,
            medName,
            manufacturer,
            stockQty,
            regDate
        )
        VALUES (
            Medicine_seq.NEXTVAL,
            #{medName},
            #{manufacturer},
            #{stockQty},
            SYSDATE
        )
    </insert>

    <!-- 목록 -->
    <select id="selectMedicineList" resultMap="MedicineResultMap">
        SELECT medId, medName, manufacturer, stockQty, regDate
        FROM Medicine
        ORDER BY medId DESC
    </select>

    <!-- 상세 -->
    <select id="selectMedicine" parameterType="com.zeus.model.Medicine" resultMap="MedicineResultMap">
        SELECT medId, medName, manufacturer, stockQty, regDate
        FROM Medicine
        WHERE medId = #{medId}
    </select>

    <!-- 수정 -->
    <update id="updateMedicine" parameterType="com.zeus.model.Medicine">
        UPDATE Medicine
        SET
            medName = #{medName},
            manufacturer = #{manufacturer},
            stockQty = #{stockQty}
        WHERE medId = #{medId}
    </update>

    <!-- 삭제 -->
    <delete id="deleteMedicine" parameterType="com.zeus.model.Medicine">
        DELETE FROM Medicine
        WHERE medId = #{medId}
    </delete>

    <!-- 검색 -->
    <select id="searchMedicine" parameterType="com.zeus.model.Medicine" resultMap="MedicineResultMap">
        SELECT medId, medName, manufacturer, stockQty, regDate
        FROM Medicine
        <where>
            <if test="medName != null and medName != ''">
                AND medName LIKE '%' || #{medName} || '%'
            </if>
            <if test="manufacturer != null and manufacturer != ''">
                AND manufacturer LIKE '%' || #{manufacturer} || '%'
            </if>
        </where>
        ORDER BY medId DESC
    </select>

</mapper>
